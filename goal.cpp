//=============================================================================
//
// プレイヤー設定
// Author:Yuda Kaito
//
//=============================================================================
#include <assert.h>
#include "goal.h"
#include "goal_effect.h"
#include "delay_process.h"

//-----------------------------------------------------------------------------
// コンストラクタ
// Author:Yuda Kaito
//-----------------------------------------------------------------------------
CGoal::CGoal() :
	m_endCnt(0),
	m_isGoal(false),
	m_isEnd(false)
{
}

//-----------------------------------------------------------------------------
// デストラクタ
// Author:Yuda Kaito
//-----------------------------------------------------------------------------
CGoal::~CGoal()
{
}

//-----------------------------------------------------------------------------
// 初期化
// Author:Yuda Kaito
//-----------------------------------------------------------------------------
HRESULT CGoal::Init()
{
	// 現在のモーション番号の保管
	LoadModel("BOX");
	CObjectX::Init();
	SetType(EType::GOAL);
	SetCollisionFlag(false);
	AttachShadow();
	return S_OK;
}

//-----------------------------------------------------------------------------
// 終了
// Author:Yuda Kaito
//-----------------------------------------------------------------------------
void CGoal::Uninit()
{
	CObjectX::Uninit();
}

//-----------------------------------------------------------------------------
// 通常更新
// Author:Yuda Kaito
//-----------------------------------------------------------------------------
void CGoal::NormalUpdate()
{
}

//-----------------------------------------------------------------------------
// 終了更新
// Author:Yuda Kaito
//-----------------------------------------------------------------------------
void CGoal::EndUpdate()
{
}

//-----------------------------------------------------------------------------
// 描画
// Author:Yuda Kaito
//-----------------------------------------------------------------------------
void CGoal::Draw()
{
	CObjectX::Draw();
}

//-----------------------------------------------------------------------------
// 生成
// Author:Yuda Kaito
//-----------------------------------------------------------------------------
CGoal* CGoal::Create()
{
	CGoal* goal = new CGoal;

	if (goal != nullptr)
	{
		goal->Init();
	}

	return goal;
}

//-----------------------------------------------------------------------------
// ゴール可能になる時間
// Author:Yuda Kaito
//-----------------------------------------------------------------------------
void CGoal::SetTime(int inTime)
{
	m_goalTime = inTime;

	// 設定された時間が経てば実行
	CDelayProcess::DelayProcess(inTime, this, [this]()
	{
		SetMaterialDiffuse(0,D3DXCOLOR(1.0f,1.0f,1.0f,1.0f));
		SetCollisionFlag(true);

		// 永遠にエフェクトを生成する
		auto effect = [this]()
		{
			for (int i = 0; i < 5; i++)
			{
				CGoalEffect::Create(GetPos());
			}
		};

		CDelayProcess::DelayProcess(3,this, effect,-1);
	});
}
